<h3 class="border-bottom py-3 px-4">Manage addresses</h3>

<div class="container py-1">
  <div class="mb-3">
    <div class="d-grid">
      <button
        type="button"
        class="btn btn-outline-success btn-lg"
        (click)="showAddressForm = true"
      >
        + Add address
      </button>
    </div>
  </div>
  <form
    *ngIf="showAddressForm"
    [formGroup]="addressForm"
    (ngSubmit)="onSubmit()"
  >
    <div>
      <div class="row mb-3">
        <div class="col">
          <input
            type="text"
            formControlName="firstName"
            class="form-control"
            placeholder="First name"
          />
        </div>
        <div class="col">
          <input
            type="text"
            formControlName="lastName"
            class="form-control"
            placeholder="Last name"
          />
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <div class="input-group">
            <span class="input-group-text">+91</span>
            <input
              type="tel"
              formControlName="phoneNumber"
              class="form-control"
              placeholder="Mobile number"
              maxlength="10"
            />
          </div>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <textarea
            formControlName="addressLine1"
            class="form-control"
            placeholder="House no / Flat no / Building / Apartment"
          ></textarea>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <textarea
            formControlName="addressLine2"
            class="form-control"
            placeholder="Street / Locality"
          ></textarea>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <input
            type="text"
            formControlName="city"
            class="form-control"
            placeholder="City"
          />
        </div>
        <div class="col">
          <input
            type="text"
            formControlName="district"
            class="form-control"
            placeholder="District"
          />
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <select
            class="form-select"
            formControlName="state"
            aria-label="state"
          >
            <option [value]="null" selected disabled>
              Select state or union territory
            </option>
            <option
              *ngFor="let stateOrUnionTerritory of statesAndUnionTerritories"
              [value]="stateOrUnionTerritory"
            >
              {{ stateOrUnionTerritory }}
            </option>
          </select>
        </div>
      </div>

      <div class="row mb-4">
        <div class="col">
          <input
            type="text"
            formControlName="landmark"
            class="form-control"
            placeholder="Landmark (Optional)"
          />
        </div>
        <div class="col">
          <input
            type="text"
            formControlName="postalCode"
            class="form-control"
            placeholder="Postal code"
            maxlength="6"
          />
        </div>
      </div>

      <div class="row mb-5">
        <div class="col">
          <div>
            <div class="form-check form-check-inline">
              <input
                type="radio"
                formControlName="alias"
                class="form-check-input"
                id="home"
                value="home"
              />
              <label for="home" class="form-check-label">Home</label>
            </div>
            <div class="form-check form-check-inline">
              <input
                type="radio"
                formControlName="alias"
                class="form-check-input"
                id="work"
                value="work"
              />
              <label for="work" class="form-check-label">Work</label>
            </div>
            <div class="form-check form-check-inline">
              <input
                type="radio"
                formControlName="alias"
                class="form-check-input"
                id="other"
                value="other"
              />
              <label for="other" class="form-check-label">Other</label>
            </div>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-start">
        <button type="submit" class="btn btn-success py-2 px-5">
          {{ edit ? "Update" : "Save" }}
        </button>
        <button
          type="submit"
          class="btn btn-link py-2 px-5"
          (click)="showAddressForm = false; addressForm.reset()"
        >
          Cancel
        </button>
      </div>
    </div>
  </form>
</div>

<div class="p-3">
  <div class="row">
    <div *ngFor="let address of addresses" class="col-12 col-lg-4">
      <div class="shadow-sm border border-secondary-subtle rounded p-4 mb-3">
        <div class="d-flex justify-content-between">
          <div class="text-uppercase fs-6 fw-medium">
            <small class="text-black-50">{{ address.alias }}</small>
          </div>
          <div class="dropdown">
            <button
              type="button"
              class="btn btn-link text-black-50 p-0"
              data-bs-toggle="dropdown"
            >
              <i class="bi bi-three-dots-vertical"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li>
                <button
                  type="button"
                  class="dropdown-item"
                  (click)="
                    patchAddressForm(address);
                    showAddressForm = true;
                    edit = true;
                    addressId = address.addressId
                  "
                >
                  Edit
                </button>
              </li>
              <li>
                <button
                  type="button"
                  class="dropdown-item"
                  (click)="deleteAddress(address.addressId!)"
                >
                  Delete
                </button>
              </li>
            </ul>
          </div>
        </div>

        <span class="text-capitalize fw-semibold lh-lg"
          >{{ address.firstName }} {{ address.lastName }}</span
        >

        <br />

        <span class="text-secondary fw-medium text-uppercase lh-base"
          >{{ address.addressLine1 }}, &nbsp;</span
        >

        <span
          *ngIf="address.addressLine2"
          class="text-secondary fw-medium text-capitalize lh-base"
          >{{ address.addressLine2 }},</span
        >

        <br />

        <span class="text-secondary fw-medium text-capitalize lh-base"
          >{{ address.city }}, {{ address.district }},
        </span>

        <br />

        <span class="text-capitalize lh-base"
          >{{ address.state }} - {{ address.postalCode }}</span
        >

        <br />
        <br />

        <span
          >Phone number:
          <small class="fw-semibold lh-lg">+91 {{ address.phoneNumber }}</small>
        </span>
      </div>
    </div>
  </div>
</div>
